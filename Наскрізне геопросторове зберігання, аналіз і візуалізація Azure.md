Геопросторові дані доступні в різних формах і вимагають широкого спектру можливостей для обробки, аналізу та візуалізації даних. Хоча географічна інформаційна система (ГІС) поширена, вона також значною мірою не є хмарною. Більшість ГІС працюють на робочому столі, що обмежує їх масштаб і продуктивність. Незважаючи на досягнення у переміщенні даних у серверну частину, ці системи залишаються прив’язаними до IaaS, що ускладнює їх масштабування.

У цій статті надано високорівневий підхід до використання нативних можливостей хмари разом із деякими параметрами програмного забезпечення з відкритим кодом і комерційними варіантами. Розглядаються три персони. Персони — це архітектори, які шукають потік високого рівня, не вникаючи в особливості реалізації. Персони включають наступне:

Генеральний геопросторовий архітектор. Цей архітектор шукає засоби для впровадження геопросторових даних, але може не мати досвіду в ГІС або дистанційному зондуванні.
Геопросторовий архітектор OSS. Цей архітектор орієнтований на програмне забезпечення з відкритим вихідним кодом (OSS), але використовує переваги хмари для обчислень і зберігання.
Геопросторовий архітектор COTS. Цей архітектор присвячений COTS, але також використовує переваги хмарних обчислень і зберігання.

### Потенційні варіанти використання

Рішення, надані в цих архітектурах, застосовуються до багатьох випадків використання:

Обробка, зберігання та надання доступу до великих обсягів растрових даних, таких як шари або кліматичні дані.
Об’єднання даних про місцезнаходження об’єктів із систем ERP із довідковими даними ГІС або включення векторних даних, масивів, хмар точок тощо.
Зберігання телеметрії Інтернету речей (IoT) з рухомих пристроїв і аналіз у режимі реального часу або пакетно
Виконання аналітичних геопросторових запитів.
Вбудовування підібраних і контекстуалізованих геопросторових даних у веб-програми.
Обробка даних з дронів, аерофотознімків, супутникових зображень, LiDAR, результатів сіткових моделей тощо.

### Загальна геопросторова архітектура

Azure має багато власних геопросторових можливостей. На цій та наступних діаграмах ви знайдете етапи високого рівня, на яких проходять геопросторові дані. По-перше, у вас є джерело даних, етап прийому, місце, де дані зберігаються, перетворюються, подаються, публікуються та, нарешті, споживаються. Зверніть увагу на піктограму глобуса біля служб із вбудованими геопросторовими можливостями. Крім того, ці діаграми не можна вважати лінійними процесами. Можна почати зі стовпця Transforms, Publish and Consume, а потім створити кілька похідних наборів даних, для чого потрібно повернутися до попереднього стовпця.

![image](https://github.com/SergeyShchus/Spatial-data-engineering/blob/main/image/geospatial-overview.png?raw=true)

Цей потік архітектури передбачає, що дані можуть надходити з баз даних, файлів або потокових джерел і не зберігатися у рідному форматі ГІС. Після отримання даних за допомогою Azure Data Factory або через Azure IoT, Event Hubs і Stream Analytics їх можна постійно зберігати в теплому сховищі за допомогою Azure SQL, Azure SQL Managed Instance, Azure Database for PostgreSQL або Azure Data Lake Storage. Звідти дані можна перетворювати та обробляти пакетно за допомогою Azure Batch або Synapse Spark Pool, обидва з яких можна автоматизувати за допомогою фабрики даних Azure або конвеєра Synapse. Для даних у реальному часі їх можна додатково трансформувати або обробити за допомогою Stream Analytics, Azure Maps або привести в контекст за допомогою Azure Digital Twins. Після перетворення даних їх можна знову використати для додаткового використання в Azure SQL DB або Azure Database для PostgreSQL, Synapse SQL Pool (для абстрактних негеопросторових даних), Azure Cosmos DB або Azure Data Explorer. Після готовності дані можна запитувати безпосередньо через API бази даних, але часто використовується рівень публікації. API даних Azure Maps буде достатнім для невеликих наборів даних, інакше можна запровадити нерідну службу на основі OSS або COTS для доступу до даних через веб-служби або настільні програми. Нарешті, веб-пакет SDK для карт Azure, розміщений у службі додатків Azure, дозволить здійснювати геовізуалізацію. Іншим варіантом є використання Azure Maps у Power BI. Нарешті, HoloLens і Azure Spatial Anchors можна використовувати для перегляду даних і розміщення їх у реальному світі для віртуальної реальності (VR) і доповненої реальності (AR).

Слід також зазначити, що багато з цих опцій є необов’язковими та можуть бути доповнені OSS, щоб зменшити витрати, одночасно зберігаючи масштабованість, або сторонніми інструментами для використання їхніх конкретних можливостей. Наступна сесія присвячена цій потребі.

### Геопросторова архітектура стороннього програмного забезпечення та програмного забезпечення з відкритим кодом

У цьому шаблоні використовується підхід до використання власних геопросторових можливостей Azure, водночас із використанням переваг деяких сторонніх інструментів і інструментів програмного забезпечення з відкритим кодом.

Найсуттєвішою відмінністю між цим підходом і попередньою блок-схемою є використання FME від Safe Software Inc., який можна придбати на Azure Marketplace. FME дозволяє геопросторовим архітекторам інтегрувати різні типи геопросторових даних, включаючи CAD (для Azure Maps Creator), ГІС, BIM, 3D, хмари точок, LIDAR тощо. Є понад 450 варіантів інтеграції, які можуть пришвидшити створення багатьох даних трансформації через свою функціональність. Однак реалізація базується на використанні віртуальної машини, а отже, має обмеження щодо її можливостей масштабування. Автоматизація перетворень FME може бути досягнута за допомогою викликів API FME з використанням фабрики даних Azure та/або за допомогою функцій Azure. Наприклад, коли дані завантажено в Azure SQL, їх можна обслуговувати в GeoServer і публікувати як службу веб-об’єктів (вектор) або службу фрагментів веб-карт (растр) і візуалізувати в веб-SDK для карт Azure або аналізувати за допомогою QGIS локально разом з іншими базовими картами Azure Maps .

![image](https://github.com/SergeyShchus/Spatial-data-engineering/blob/main/image/geospatial-3rd-open-source-software.png?raw=true)

### Геопросторова архітектура COTS: Esri зі статичними та потоковими джерелами

Наступний підхід, який ми розглянемо, використовує комерційну ГІС як основу для рішення. Технологія Esri, доступна на Azure Marketplace, буде основою для цієї архітектури, хоча інше комерційне програмне забезпечення може відповідати тим самим шаблонам. Як і раніше, джерела, прийом, (необроблене) зберігання, завантаження/обслуговування в основному залишаються незмінними. Дані також можна трансформувати за допомогою ArcGIS Pro на автономному комп’ютері (VM) або як частину більшого рішення за допомогою Azure Virtual Desktop . Дані можна опублікувати через ArcGIS Enterprise або за допомогою ArcGIS Enterprise на Kubernetes (служба Azure Kubernetes). Зображення можна обробляти на IaaS за допомогою ArcGIS Image як частини розгортання ArcGIS Enterprise. Дані можуть використовуватися у веб-додатках, розміщених у Azure App Service за допомогою ArcGIS JavaScript SDK, кінцевого користувача ArcGIS Pro, мобільного SDK ArcGIS Runtime або ArcGIS для Power BI. Так само користувачі можуть використовувати дані за допомогою ArcGIS Online.

![image](https://github.com/SergeyShchus/Spatial-data-engineering/blob/main/image/geospatial-esri-static.png?raw=true)

### Архітектура геопросторових зображень COTS: зображення ArcGIS від Esri та Azure Orbital

Наступна архітектура включає Azure Orbital і ArcGIS Image від Esri. Завдяки цьому наскрізному потоку Azure Orbital дозволяє планувати контакти із супутниками та передавати дані у віртуальну машину або потоково передавати в центри подій Azure. Окрім прямих потокових супутникових даних, на платформу можна завантажувати й обробляти дані, отримані з дронів або інші зображення. Необроблені дані можна зберігати у файлах Azure NetApp, обліковому записі Azure Storage (blob) або в базі даних, наприклад Azure Database для PostgreSQL. Залежно від супутника та сенсорної платформи дані перетворюються з набору даних рівня 0 до рівня 2. Див. Рівні обробки даних NASA . Який рівень потрібен, залежить від супутника та датчика. Далі ArcGIS Pro може перетворити дані в набір даних Mosaic. Потім набір даних Mosaic перетворюється на службу зображень за допомогою ArcGIS Enterprise (на віртуальних машинах або Kubernetes). ArcGIS Image Server може обслуговувати дані безпосередньо як сервіс зображень, або користувач може використовувати сервіс зображень через ArcGIS Image for ArcGIS Online .

![image](https://github.com/SergeyShchus/Spatial-data-engineering/blob/main/image/geospatial-esri-image.png?raw=true)

### Архітектура геопросторових зображень COTS/програмне забезпечення з відкритим вихідним кодом: готовий набір даних Azure Space для аналізу

Коли набори даних, готові до аналізу, стають доступними через API, які дають змогу здійснювати пошук і запити, як у випадку з планетарним комп’ютером Microsoft, немає необхідності спочатку завантажувати дані із супутника. Однак якщо для отримання зображень потрібні короткі терміни, ідеальним є отримання даних безпосередньо з Azure Space, оскільки супутниковий оператор або організація, керована місією, може запланувати контакт із супутником через Azure Orbital. Процес переходу від рівня 0 до рівня 2 готового до аналізу набору даних залежить від супутника та зображень. Часто потрібні кілька інструментів і проміжні кроки. Azure Batch або інший обчислювальний ресурс може обробляти дані в кластері та зберігати отримані дані. Дані можуть пройти кілька етапів, перш ніж вони будуть готові до використання в ArcGIS або QGIS або будь-якому іншому інструменті геовізуалізації. Наприклад, коли дані перебувають у форматі GeoTIFF, оптимізованому для хмари (COG), вони подаються через обліковий запис зберігання або Azure Data Lake і стають доступними та доступними для запитів через STAC API , який можна розгорнути в Azure як службу за допомогою AKS. серед інших. Крім того, дані публікуються як веб-картографічна служба за допомогою GeoServer. Потім споживачі можуть отримати доступ до даних в ArcGIS Pro або QGIS або через веб-програму з Azure Maps або мобільні та веб-пакети SDK Esri.

![image](https://github.com/SergeyShchus/Spatial-data-engineering/blob/main/image/geospatial-space-ard.png?raw=true)

### Компоненти

- Azure Event Hubs — це повністю керована потокова платформа для великих даних. Ця платформа як послуга (PaaS) пропонує розділену споживчу модель. Кілька програм можуть використовувати цю модель для обробки потоку даних одночасно.
- Azure Orbital — це повністю керована хмарна наземна станція як сервіс, який дозволяє оптимізувати ваші операції, надаючи космічні дані безпосередньо в Azure.
- Azure Data Factory — це служба інтеграції, яка працює з даними з різних сховищ даних. Ви можете використовувати цю повністю керовану безсерверну платформу для створення, планування та оркестрування робочих процесів перетворення даних.
- Azure Cosmos DB — це повністю керована служба бази даних NoSQL для розробки сучасних програм.
- Azure Synapse Analytics — це служба корпоративної аналітики, яка прискорює аналіз сховищ даних і систем великих даних.
- Azure Digital Twins — це платформа як сервісна пропозиція, яка дозволяє створювати подвійні графіки на основі цифрових моделей цілих середовищ, якими можуть бути будівлі, фабрики, ферми, енергетичні мережі, залізниці, стадіони або цілі міста.
- Azure Virtual Desktop — це служба віртуалізації робочого столу та програм, яка працює в хмарі.
- Azure Databricks — це платформа аналітики даних. Його повністю керовані кластери Spark обробляють великі потоки даних із багатьох джерел. Azure Databricks може трансформувати геопросторові дані у великих масштабах для використання в аналітиці та візуалізації даних.
- Azure Batch дозволяє запускати великомасштабні паралельні та високопродуктивні обчислювальні завдання.
- Azure Data Lake Storage — це масштабоване та безпечне озеро даних для високопродуктивних аналітичних навантажень. Ця служба може обробляти кілька петабайтів інформації, зберігаючи при цьому сотні гігабіт пропускної здатності. Дані зазвичай надходять із кількох різнорідних джерел і можуть бути структурованими, напівструктурованими чи неструктурованими.
- База даних SQL Azure — це версія PaaS SQL Server і інтелектуальна, масштабована служба реляційної бази даних.
- База даних Azure для PostgreSQL — це повністю керована служба реляційної бази даних, яка базується на версії спільноти механізму бази даних PostgreSQL з відкритим кодом .
- PostGIS — це розширення для бази даних PostgreSQL, яке інтегрується з ГІС-серверами. PostGIS може запускати запити розташування SQL, які включають географічні об’єкти.
- Power BI — це набір програмних служб і програм. Ви можете використовувати Power BI для підключення непов’язаних джерел даних і створення з них візуальних елементів.
- Візуальний елемент Azure Maps для Power BI надає можливість покращити карти за допомогою просторових даних. Ви можете використовувати цей візуал, щоб показати, як дані про місцезнаходження впливають на бізнес-метрики.
- Служба додатків і її функція веб-програм забезпечують основу для створення, розгортання та масштабування веб-програм. Платформа App Service пропонує вбудовану підтримку інфраструктури, виправлення безпеки та масштабування.
- API даних ГІС у Картах Azure зберігають і отримують дані карт у таких форматах, як GeoJSON і векторні плитки.
- Azure Data Explorer — це швидка, повністю керована служба аналітики даних, яка може працювати з великими обсягами даних . Ця служба спочатку була зосереджена на часових рядах і аналітиці журналів. Тепер він також обробляє різноманітні потоки даних із програм, веб-сайтів, пристроїв Інтернету речей та інших джерел. Геопросторові функції в Azure Data Explorer надають параметри для відтворення картографічних даних.
- Файли Azure NetApp — це високопродуктивна мережева служба зберігання даних (NAS) корпоративного класу.
- Quantum GIS — це безкоштовна настільна ГІС з відкритим кодом, яка підтримує редагування, аналіз і геовізуалізацію геопросторових даних.
- ArcGIS Enterprise — це платформа для картографування та геовізуалізації, аналітики та керування даними, яка містить дані, додатки та спеціальні додатки з низьким кодом/без коду. Він працює разом із настільною ГІС під назвою ArcGIS Pro або ArcGIS Desktop (тут не включено, оскільки її замінив ArcGIS Pro).
- ArcGIS Pro — це професійна настільна ГІС-програма Esri. Це дозволяє досвідченим користувачам досліджувати, геовізуалізувати та аналізувати дані. Він включає в себе можливості 2D і 3D і найкраще працює на віртуальних машинах Azure High Performance Compute, таких як серія NV. Використання ArcGIS можна масштабувати за допомогою Azure Virtual Desktop.
- ArcGIS Image for ArcGIS Online — це розширення ArcGIS Online (SaaS), яке дозволяє здійснювати геовізуалізацію, розміщення, публікацію та аналіз.
- Специфікація STAC API дозволяє запитувати та отримувати растрові дані через каталог.
- 
Хоча це не показано на діаграмах вище, Azure Monitor, Log Analytics і Key Vault також будуть частиною ширшого рішення.

- Azure Monitor збирає дані про середовища та ресурси Azure. Ця діагностична інформація корисна для підтримки доступності та продуктивності. Монітор складається з двох платформ даних:
- Azure Monitor Logs записує та зберігає дані про журнал і продуктивність.
- Azure Monitor Metrics збирає числові значення через регулярні проміжки часу.
- Azure Log Analytics — це інструмент порталу Azure, який виконує запити до даних журналу моніторингу. Log Analytics також надає функції для створення діаграм і статистичного аналізу результатів запитів.
- Key Vault зберігає та контролює доступ до секретів, таких як маркери, паролі та ключі API. Key Vault також створює та контролює ключі шифрування та керує сертифікатами безпеки.

### Альтернативи

Доступні різні бібліотеки Spark для роботи з геопросторовими даними на Azure Databricks і Synapse Spark Pools. Перегляньте ці бібліотеки:

- Apache Sedona (GeoSpark)
- GeoPandas
- GeoTrellis

Але існують також інші рішення для обробки та масштабування геопросторових робочих навантажень за допомогою Azure Databricks .

Інші бібліотеки Python, які варто розглянути, включають PySAL , Rasterio , WhiteboxTools , Turf.js , Pointpats , Raster Vision , EarthPy , Planetary Computer , PDAL тощо.

Векторні плитки забезпечують ефективний спосіб відображення даних ГІС на картах. Рішення може використовувати PostGIS для динамічного запиту векторних фрагментів. Цей підхід добре працює для простих запитів і наборів результатів, які містять значно менше 1 мільйона записів. Але в наведених нижче випадках інший підхід може бути кращим:

- Ваші запити дорого обчислюються.
- Ваші дані не змінюються часто.
- Ви показуєте великі набори даних.

У таких ситуаціях розгляньте можливість використання Tippecanoe для створення векторних плиток. Ви можете запустити Tippecanoe як частину потоку обробки даних, як контейнер або за допомогою функцій Azure . Ви можете зробити отримані плитки доступними через API.

Як і Event Hub, Azure IoT Hub може отримувати великі обсяги даних. Але IoT Hub також пропонує можливості двонаправленого зв’язку з пристроями. Якщо ви отримуєте дані безпосередньо з пристроїв, але також надсилаєте команди та політики назад на пристрої, розгляньте IoT Hub замість Event Hub.
